<ng-template #spinner>
  <pdc-spinner-dots></pdc-spinner-dots>
</ng-template>

<div class="table-responsive list-height-custom custom-scroll">
  <table
    mat-table
    [dataSource]="dataSource"
    class="table-default"
    *ngIf="!isLoading; else spinner"
    [attr.aria-label]="'Data table'"
  >
    <ng-container
      *ngFor="let column of columnConfig; let i = index"
      [matColumnDef]="column.id"
      [ngSwitch]="column.type"
    >
      <!-- MENU -->
      <ng-container *ngSwitchCase="columnType.MENU" stickyEnd>
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
        ></th>
        <td
          mat-cell
          *matCellDef="let element; let i = index"
          class="operations-menu"
          [id]="column.id + '-td-' + i"
        >
          <button
            #menuTrigger="matMenuTrigger"
            [matMenuTriggerFor]="menu"
            class="operations-button"
            [id]="column.id + '-show-submenu-' + i"
          >
            <img
              alt="Menu"
              [src]="'assets/images/icons/3_dots.svg'"
              [id]="column.id + '-icon-' + i"
            />
          </button>

          <mat-menu #menu="matMenu" class="optmenu-wrapper">
            <button
              *ngFor="let item of actionMenu; let j = index"
              mat-menu-item
              [id]="item"
              (click)="item.action(element)"
            >
              <span *ngIf="element.actionMenuTable?.findIndex(item.id) > -1">{{
                item.label | translate
              }}</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <!-- TEXT -->
      <ng-container *ngSwitchCase="columnType.TEXT || undefined || null">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
          mat-sort-header
        >
          {{ column.label ?? '' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" [id]="column.id + '-th-' + i">
          <span *ngIf="column.href"
            ><a [id]="column.id + 'col-text-a-' + i" [href]="element.href">{{
              element[column.id]
            }}</a></span
          >
          <span *ngIf="!column.href">{{ element[column.id] }}</span>
        </td>
      </ng-container>

      <!-- AMOUNT -->
      <ng-container *ngSwitchCase="columnType.AMOUNT">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
          mat-sort-header
          class="mat-cell-right"
        >
          {{ column.label ?? '' | translate }}
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          [id]="column.id + '-th-' + i"
          class="amount-td right-cell"
        >
          <span *ngIf="column.href"
            ><a [id]="column.id + 'col-num-a-' + i" [href]="element.href"
              >{{ element[column.id] | number: '1.2-2':locale }}
            </a></span
          >
          <span *ngIf="!column.href"
            >{{ element[column.id] | number: '1.2-2':locale }}
          </span>
        </td>
      </ng-container>

      <!-- DATE -->
      <ng-container *ngSwitchCase="columnType.DATE">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
          mat-sort-header
        >
          {{ column.label ?? '' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" [id]="column.id + '-th-' + i">
          {{ element[column.id] | date: column.pipeFormat }}
        </td>
      </ng-container>

      <!-- CURRENCY -->
      <ng-container *ngSwitchCase="columnType.CURRENCY">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
          mat-sort-header
          class="mat-cell-center"
        >
          {{ column.label ?? '' | translate }}
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          [id]="column.id + '-th-' + i"
          class="center-cell"
        >
          <span class="mat-column-currency">{{ element[column.id] }}</span>
        </td>
      </ng-container>

      <!-- CHECKBOX -->
      <ng-container *ngSwitchCase="columnType.CHECKBOX">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="checkAllChanged($event.checked)"
            [(ngModel)]="isCheckAll"
            [id]="'select-all-checkbox'"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="checkChanged($event, row)"
            [(ngModel)]="row.selected"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- ICON BUTTON ***************************************************************************************** -->
      <ng-container *ngSwitchCase="columnType.ICON_BTTN">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
        ></th>
        <td mat-cell *matCellDef="let element" [id]="column.id + '-td-' + i">
          <mat-icon
            [id]="column.id + '-icon-' + i"
            [ngClass]="column.class ?? ''"
            *ngIf="column.hasOwnProperty('show') ? column.show : true"
            (click)="column.action(element)"
            [matTooltip]="column.toolTipMessage ?? ''"
            [matTooltipClass]="'flame-tooltip'"
            [matTooltipPosition]="'above'"
          >
          </mat-icon>
        </td>
      </ng-container>

      <!-- ICON INFO ***************************************************************************************** -->
      <ng-container *ngSwitchCase="columnType.ICON_INFO">
        <th
          mat-header-cell
          *matHeaderCellDef
          [id]="column.id + '-th-' + i"
        ></th>
        <td mat-cell *matCellDef="let element" [id]="column.id + '-td-' + i">
          <mat-icon
            [id]="column.id + '-icon-' + i"
            class="icon-list"
            *ngIf="column.hasOwnProperty('show') ? column.show : true"
            matTooltip="Info about the action"
          >
            <img [alt]="column.id" [src]="column.src" />
          </mat-icon>
        </td>
      </ng-container>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
  </table>
</div>
